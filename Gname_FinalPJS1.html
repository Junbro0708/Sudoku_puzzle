<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
    <style>
        body{
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        td{
            width: 40px;
            height: 40px;
            border: solid 1px;
            border-collapse: collapse;
            text-align: center;
        }
    </style>
</head>
<body>
    <table></table>
    <button id="validate">Validate</button>
    <h2 style="display: none;"></h2>
    <div class="checkbtns" style="display: none;">
        <button id="checkrow">Check the wrong Row</button>
        <button id="checkcol">Check the wrong Column</button>
        <button id="checkrowcol">Check the wrong Row & Column</button>
        <button id="checkbox">Check the wrong Box</button>
        <button id="checkidx">Check the wrong indexs</button>
        <button id="reset">Reset</button>
    </div>
</body>
<script>
    let size, values;
    let h2EL = document.querySelector("h2");
    let randomColor;
    let wrongIdx = new Map();
    let wrongRow = new Set();
    let wrongCol = new Set();
    let wrongBox = new Set();

    let tablePop = (values) => {
        const table = document.querySelector("table");
        for(let rowidx in values){
            let tr = document.createElement("tr");
            for(let colIdx in values[rowidx]){
                let td = document.createElement("td");
                td.innerHTML = values[rowidx][colIdx];
                tr.appendChild(td);
            }
            table.appendChild(tr);
        }
    }

    let loadJson = () =>{
        const xmlHTTP = new XMLHttpRequest();
        xmlHTTP.onload = function(){
            let output = JSON.parse(this.responseText)[1]; //You can change the puzzle with an index
            size = output.size;
            values = output.values;
            tablePop(values);
            checkSudoku(size, values);

            designSudoku(size);
        }
        xmlHTTP.open("GET","./source.json",true);
        xmlHTTP.send();
    }
    loadJson();

    // Check validate Columns
    function checkValColumns(columnIdx, sudokuArray, size){
        let nums = new Map();
        let flag = false;
        for(let i = 0; i < size; i++){
            if(sudokuArray[columnIdx][i] != 0){
                if(nums.has(sudokuArray[columnIdx][i])){
                    wrongIdx.set(`${nums.get(sudokuArray[columnIdx][i]).columnIdx},${nums.get(sudokuArray[columnIdx][i]).i}`, sudokuArray[columnIdx][i]);
                    wrongIdx.set(`${columnIdx},${i}`, sudokuArray[columnIdx][i]);
                    wrongCol.add(columnIdx);
                    flag = true;
                }else{
                    nums.set(sudokuArray[columnIdx][i], {columnIdx, i})
                }
            }
        }
        if(flag) return true;
        else return false;
    }
    
    //Check validate Rows
    function checkValRows(rowIdx, sudokuArray, size){
        let nums = new Map();
        let flag = false;
        for(let i = 0; i < size; i++){
            if(sudokuArray[i][rowIdx] != 0){
                if(nums.has(sudokuArray[i][rowIdx])){
                    wrongIdx.set(`${nums.get(sudokuArray[i][rowIdx]).i},${nums.get(sudokuArray[i][rowIdx]).rowIdx}`, sudokuArray[i][rowIdx]);
                    wrongIdx.set(`${i},${rowIdx}`, sudokuArray[i][rowIdx]);
                    wrongRow.add(rowIdx);
                    flag = true;
                }else{
                    nums.set(sudokuArray[i][rowIdx], {i, rowIdx});
                }
            }
        }
        if(flag) return true;
        else return false;
    }

    // Check validate Boxes
    function checkValBoxes(columnIdx, rowIdx, sudokuArray, size){
        boxXIdx = Math.floor(columnIdx / Math.sqrt(size));
        boxYIdx = Math.floor(rowIdx / Math.sqrt(size));
        let nums = new Map();
        let flag = false;
        for(let i = 0; i < Math.sqrt(size); i++){
            for(let j = 0; j < Math.sqrt(size); j++){
                let x = i + (Math.sqrt(size) * boxXIdx);
                let y = j + (Math.sqrt(size) * boxYIdx);
                if(sudokuArray[x][y] != 0){
                    if(nums.has(sudokuArray[x][y])){
                        wrongIdx.set(`${nums.get(sudokuArray[x][y]).x},${nums.get(sudokuArray[x][y]).y}`, sudokuArray[x][y]);
                        wrongIdx.set(`${x},${y}`, sudokuArray[x][y]);
                        wrongBox.add({x, y})
                        flag = true;
                    }else{
                        nums.set(sudokuArray[x][y], {x, y});
                    }
                }
            }
        }
        if(flag) return true;
        else return false;
    }

    // Check All validate (Columns, Rows, Boxes)
    function checkAllValidate(columnIdx, rowIdx, sudokuArray, size){
        let flag = false;
        if(checkValColumns(columnIdx, sudokuArray, size)){
            flag = true;
        }
        if(checkValRows(rowIdx, sudokuArray, size)){
            flag = true;
        }
        if(checkValBoxes(columnIdx, rowIdx, sudokuArray, size)){
            flag = true;
        }
        if(flag) return true;
        else return false;
    }

    // Check if the array is right
    function checkSudoku(size, sudokuArray){
        let flag = false;
        for(let i = 0; i < sudokuArray.length; i++){
            for(let j = 0; j < sudokuArray.length; j++){
                if(checkAllValidate(i, j, sudokuArray, size)){
                    h2EL.innerText = "This is wrong sudoku puzzle.";
                    flag = true;
                }
            }
        }
        if(!flag) h2EL.innerText = "This is the answer of the puzzle.";
    }

    // design looking like more sudoku
    function designSudoku(size){
        let sudoku = document.querySelector("table").children;
        let tempRow = 1;
        let tempCol = 1;
        for(let i = 0; i < sudoku.length; i++){
            if((tempRow == Math.sqrt(size)) && i != sudoku.length-1){
                for(let j = 0; j < sudoku[i].children.length; j++){
                    sudoku[i].children[j].style.borderBottom = "solid 5px black";
                }
                tempRow = 0;
            }
            for(let j = 0; j < sudoku[i].children.length; j++){
                if((tempCol == Math.sqrt(size)) && j != sudoku.length-1){
                    sudoku[i].children[j].style.borderRight = "solid 5px black";
                    tempCol = 0;
                }
                tempCol++;
            }
            tempCol = 1;
            tempRow++;
        }


    }
    
    //Check exact indexs for the wrong numbers
    function checkExactIndexs(size){
        randomColor = new Array(size);
            for(let i = 0; i < randomColor.length; i++){
            randomColor[i] = "#" + Math.floor(Math.random()*16777215).toString(16);
            }
        let sudoku = document.querySelector("table").children;
        wrongIdx.forEach((val, idx)=>{
            let x = idx.split(",")[0];
            let y = idx.split(",")[1];
            sudoku[x].children[y].style.backgroundColor = randomColor[val-1];
        })
    }

    //Check exact Column and Row for the wrong numbers
    function checkExactCol(size){
        let sudoku = document.querySelector("table").children;
        wrongCol.forEach((val)=>{
            for(let i = 0; i < size; i++){
                sudoku[val].children[i].style.backgroundColor = "red";
            }
        })
    }
    function checkExactRow(size){
        let sudoku = document.querySelector("table").children;
        wrongRow.forEach((val)=>{
            for(let i = 0; i < size; i++){
                sudoku[i].children[val].style.backgroundColor = "red";
            }
        })
    }
    function checkExactBox(size){
        let sudoku = document.querySelector("table").children;
        wrongBox.forEach((val)=>{
            boxXIdx = Math.floor(val.x / Math.sqrt(size));
            boxYIdx = Math.floor(val.y / Math.sqrt(size));
            for(let i = 0; i < Math.sqrt(size); i++){
                for(let j = 0; j < Math.sqrt(size); j++){
                    let x = i + (Math.sqrt(size) * boxXIdx);
                    let y = j + (Math.sqrt(size) * boxYIdx);
                    sudoku[x].children[y].style.backgroundColor = "red";
                }
            }
        })
    }
    function initialize(size){
        let sudoku = document.querySelector("table").children;
        for(let i = 0; i < size; i ++){
            for(let j = 0; j < size; j++){
                sudoku[i].children[j].style.backgroundColor = "white";
            }
        }
    }
    
    //Button
    $("#validate").on("click", (e)=>{
        $(h2EL).css("display", "block");
        switch($(h2EL).text()){
            case "This is the answer of the puzzle.":
                $($(".checkbtns")[0]).css("display", "none");
            break;
            case "This is wrong sudoku puzzle.":
                $($(".checkbtns")[0]).css("display", "block");
            break;
        }
        $(e.target).attr("disabled", true);
    })
    $("#checkrow").on("click", ()=>{
        initialize(size);
        checkExactRow(size);
    })
    $("#checkcol").on("click", ()=>{
        initialize(size);
        checkExactCol(size);
    })
    $("#checkrowcol").on("click", ()=>{
        initialize(size);
        checkExactRow(size);
        checkExactCol(size);
    })
    $("#checkbox").on("click", ()=>{
        initialize(size);
        checkExactBox(size);
    })
    $("#checkidx").on("click", ()=>{
        initialize(size);
        checkExactIndexs(size);
    })
    $("#reset").on("click", ()=>{
        initialize(size);
    })
</script>
</html>